<?xml version="1.0" encoding="UTF-8"?>
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="http://www.opentrafficsim.org/ots"
  xmlns:ots="http://www.opentrafficsim.org/ots" 
  xmlns:xi="http://www.w3.org/2001/XInclude"
  elementFormDefault="qualified">

  <!-- http://www.w3.org/2009/01/xml.xsd -->
  <xsd:import namespace="http://www.w3.org/XML/1998/namespace" schemaLocation="ref/xml.xsd" />
  <!-- http://www.w3.org/2001/xinclude.xsd -->
  <xsd:import namespace="http://www.w3.org/2001/XInclude" schemaLocation="ref/xinclude.xsd" />

  <xsd:include schemaLocation="ots-types.xsd" />

  <!-- ================================================================================================== -->
  <!-- =============================================== ELEMENTS ========================================= -->
  <!-- ================================================================================================== -->

  <xsd:element name="GTUTYPE">
    <xsd:complexType>
      <xsd:attribute name="ID" type="xsd:string" use="required" />
      <xsd:attribute name="PARENT" type="xsd:string" use="optional" />
      <xsd:attribute name="DEFAULT" type="xsd:boolean" use="optional" default="false" />
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="GTUTYPES">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="ots:GTUTYPE" minOccurs="0" maxOccurs="unbounded" />
      </xsd:sequence>
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="GTUTEMPLATE">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element name="LENGTHDIST" type="ots:LENGTHDISTTYPE" minOccurs="1" />
        <xsd:element name="WIDTHDIST" type="ots:LENGTHDISTTYPE" minOccurs="1" />
        <xsd:element name="MAXSPEEDDIST" type="ots:SPEEDDISTTYPE" minOccurs="1" />
        <xsd:element name="MAXACCELERATIONDIST" type="ots:ACCELERATIONDISTTYPE" minOccurs="0" />
        <xsd:element name="MAXDECELERATIONDIST" type="ots:ACCELERATIONDISTTYPE" minOccurs="0" />
      </xsd:sequence>
      <xsd:attribute name="ID" type="xsd:string" use="required" />
      <xsd:attribute name="GTUTYPE" type="xsd:string" use="required" />
      <xsd:attribute name="DEFAULT" type="xsd:boolean" use="optional" default="false" />
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="GTUTEMPLATES">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="ots:GTUTEMPLATE" minOccurs="0" maxOccurs="unbounded" />
      </xsd:sequence>
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="COMPATIBILITY">
    <xsd:complexType>
      <xsd:attribute name="GTUTYPE" type="xsd:string" use="required" />
      <xsd:attribute name="DIRECTION" type="ots:DRIVINGDIRECTIONTYPE" use="required">
        <xsd:annotation>
          <xsd:documentation source="description">
            DRIVINGDIRECTIONTYPE: FORWARD|BACKWARD|BOTH|NONE
          </xsd:documentation>
        </xsd:annotation>
      </xsd:attribute>
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="LANETYPE">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="ots:COMPATIBILITY" minOccurs="1" maxOccurs="unbounded" />
      </xsd:sequence>
      <xsd:attribute name="ID" type="xsd:string" use="required" />
      <xsd:attribute name="PARENT" type="xsd:string" use="optional" />
      <xsd:attribute name="DEFAULT" type="xsd:boolean" use="optional" default="false" />
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="LANETYPES">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="ots:LANETYPE" minOccurs="0" maxOccurs="unbounded" />
      </xsd:sequence>
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="LINKTYPE">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="ots:COMPATIBILITY" minOccurs="1" maxOccurs="unbounded" />
        <xsd:element ref="ots:SPEEDLIMIT" minOccurs="0" maxOccurs="unbounded" />
      </xsd:sequence>
      <xsd:attribute name="ID" type="xsd:string" use="required" />
      <xsd:attribute name="PARENT" type="xsd:string" use="optional" />
      <xsd:attribute name="DEFAULT" type="xsd:boolean" use="optional" default="false" />
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="LINKTYPES">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="ots:LINKTYPE" minOccurs="0" maxOccurs="unbounded" />
      </xsd:sequence>
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

  <xsd:element name="SPEEDLIMIT">
    <xsd:complexType>
      <xsd:attribute name="GTUTYPE" type="xsd:string" use="required" />
      <xsd:attribute name="LEGALSPEEDLIMIT" type="ots:SPEEDTYPE" use="optional" />
    </xsd:complexType>
  </xsd:element>

  <xsd:complexType name="CROSSSECTIONELEMENT">
    <xsd:sequence>
      <xsd:choice minOccurs="0">
        <xsd:element name="CENTEROFFSET" type="ots:LENGTHTYPE" />
        <xsd:element name="LEFTOFFSET" type="ots:LENGTHTYPE" />
        <xsd:element name="RIGHTOFFSET" type="ots:LENGTHTYPE" />
        <xsd:sequence>
          <xsd:choice>
            <xsd:element name="CENTEROFFSETSTART" type="ots:LENGTHTYPE" />
            <xsd:element name="LEFTOFFSETSTART" type="ots:LENGTHTYPE" />
            <xsd:element name="RIGHTOFFSETSTART" type="ots:LENGTHTYPE" />
          </xsd:choice>
          <xsd:choice>
            <xsd:element name="CENTEROFFSETEND" type="ots:LENGTHTYPE" />
            <xsd:element name="LEFTOFFSETEND" type="ots:LENGTHTYPE" />
            <xsd:element name="RIGHTOFFSETEND" type="ots:LENGTHTYPE" />
          </xsd:choice>
        </xsd:sequence>
      </xsd:choice>
      <xsd:choice>
        <xsd:element name="WIDTH" type="ots:POSITIVELENGTHTYPE" />
        <xsd:sequence>
          <xsd:element name="WIDTHSTART" type="ots:LENGTHTYPE" />
          <xsd:element name="WIDTHEND" type="ots:LENGTHTYPE" />
        </xsd:sequence>
      </xsd:choice>
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="CSELANE">
    <xsd:complexContent>
      <xsd:extension base="ots:CROSSSECTIONELEMENT">
        <xsd:sequence>
          <xsd:element ref="ots:SPEEDLIMIT" minOccurs="0" maxOccurs="unbounded" />
        </xsd:sequence>
        <xsd:attribute name="ID" type="xsd:string" use="required" />
        <xsd:attribute name="LANETYPE" type="xsd:string" use="required" />
        <xsd:attribute name="DESIGNDIRECTION" type="xsd:boolean" use="required" />
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="CSENOTRAFFICLANE">
    <xsd:complexContent>
      <xsd:extension base="ots:CROSSSECTIONELEMENT">
        <xsd:attribute name="ID" type="xsd:string" use="optional" />
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="CSESHOULDER">
    <xsd:complexContent>
      <xsd:extension base="ots:CROSSSECTIONELEMENT">
        <xsd:attribute name="ID" type="xsd:string" use="optional" />
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="CSESTRIPE">
    <xsd:sequence>
      <xsd:choice minOccurs="0">
        <xsd:element name="CENTEROFFSET" type="ots:LENGTHTYPE" />
        <xsd:sequence>
          <xsd:choice>
            <xsd:element name="CENTEROFFSETSTART" type="ots:LENGTHTYPE" />
          </xsd:choice>
          <xsd:choice>
            <xsd:element name="CENTEROFFSETEND" type="ots:LENGTHTYPE" />
          </xsd:choice>
        </xsd:sequence>
      </xsd:choice>
      <xsd:element name="DRAWINGWIDTH" type="ots:POSITIVELENGTHTYPE" minOccurs="0" maxOccurs="1" />
    </xsd:sequence>
    <xsd:attribute name="ID" type="xsd:string" use="optional" />
    <xsd:attribute name="TYPE" type="ots:STRIPETYPE" use="required" />
  </xsd:complexType>

  <xsd:element name="ROADLAYOUTS">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:element ref="ots:ROADLAYOUT" minOccurs="0" maxOccurs="unbounded" />
      </xsd:sequence>
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

  <xsd:complexType name="BASICROADLAYOUT">
    <xsd:sequence>
      <xsd:sequence minOccurs="1" maxOccurs="unbounded">
        <xsd:choice>
          <xsd:element name="LANE" type="ots:CSELANE" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="NOTRAFFICLANE" type="ots:CSENOTRAFFICLANE" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="SHOULDER" type="ots:CSESHOULDER" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="STRIPE" type="ots:CSESTRIPE" minOccurs="0" maxOccurs="unbounded" />
        </xsd:choice>
      </xsd:sequence>
      <xsd:element ref="ots:SPEEDLIMIT" minOccurs="0" maxOccurs="unbounded" />
    </xsd:sequence>
    <xsd:attribute name="LANEKEEPING" type="ots:LANEKEEPINGTYPE" use="optional" />
    <xsd:attribute ref="xml:base" />
  </xsd:complexType>

  <xsd:element name="ROADLAYOUT">
    <xsd:annotation>
      <xsd:documentation source="description">
        Road layout. Lanes to the right of the design line have negative
        offset. Those to the right have positive offset. When not specifying offsets, sequence
        the lines from right (most negative) to left (most positive).
      </xsd:documentation>
    </xsd:annotation>
    <xsd:complexType>
      <xsd:complexContent>
        <xsd:extension base="ots:BASICROADLAYOUT">
          <xsd:attribute name="ID" type="xsd:string" use="required" />
          <xsd:attribute name="LINKTYPE" type="xsd:string" use="required" />
        </xsd:extension>
      </xsd:complexContent>
    </xsd:complexType>
    <!-- the LANE.ID should be unique within one ROADLAYOUT -->
    <xsd:unique name="uniqueRoadLayoutLaneId">
      <xsd:selector xpath="ots:LANE" />
      <xsd:field xpath="@ID" />
    </xsd:unique>
  </xsd:element>

  <xsd:element name="PARAMETERTYPES">
    <xsd:complexType>
      <xsd:sequence>
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="STRING" type="ots:PARAMETERTYPESTRING" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="ACCELERATION" type="ots:PARAMETERTYPEACCELERATION" minOccurs="0"
            maxOccurs="unbounded" />
          <xsd:element name="BOOLEAN" type="ots:PARAMETERTYPEBOOLEAN" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="CLASS" type="ots:PARAMETERTYPECLASS" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="DOUBLE" type="ots:PARAMETERTYPEDOUBLE" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="FLOAT" type="ots:PARAMETERTYPEFLOAT" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="LONG" type="ots:PARAMETERTYPELONG" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="DURATION" type="ots:PARAMETERTYPEDURATION" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="FRACTION" type="ots:PARAMETERTYPEFRACTION" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="FREQUENCY" type="ots:PARAMETERTYPEFREQUENCY" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="INTEGER" type="ots:PARAMETERTYPEINTEGER" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="LENGTH" type="ots:PARAMETERTYPELENGTH" minOccurs="0" maxOccurs="unbounded" />
          <xsd:element name="LINEARDENSITY" type="ots:PARAMETERTYPELINEARDENSITY" minOccurs="0"
            maxOccurs="unbounded" />
          <xsd:element name="SPEED" type="ots:PARAMETERTYPESPEED" minOccurs="0" maxOccurs="unbounded" />
        </xsd:choice>
      </xsd:sequence>
    </xsd:complexType>
  </xsd:element>

  <!-- ================================================================================================== -->
  <!-- ============================================== DEFINITIONS ======================================= -->
  <!-- ================================================================================================== -->

  <xsd:element name="DEFINITIONS">
    <xsd:complexType>
      <xsd:sequence minOccurs="0" maxOccurs="unbounded">
        <xsd:element ref="xi:include" minOccurs="0" maxOccurs="unbounded" />
        <xsd:element ref="ots:GTUTYPES" minOccurs="0" maxOccurs="unbounded" />
        <xsd:element ref="ots:GTUTEMPLATES" minOccurs="0" maxOccurs="unbounded" />
        <xsd:element ref="ots:LINKTYPES" minOccurs="0" maxOccurs="unbounded" />
        <xsd:element ref="ots:LANETYPES" minOccurs="0" maxOccurs="unbounded" />
        <xsd:element ref="ots:ROADLAYOUTS" minOccurs="0" maxOccurs="unbounded" />
        <xsd:element ref="ots:PARAMETERTYPES" minOccurs="0" maxOccurs="unbounded" />
      </xsd:sequence>
      <xsd:attribute ref="xml:base" />
    </xsd:complexType>
  </xsd:element>

</xsd:schema>
